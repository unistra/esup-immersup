{% extends "base.html" %}
{% load static staticfiles i18n immersionlyceens_tags %}
{% get_current_language as LANGUAGE_CODE %}
{% block head-css %}
<link rel="stylesheet" href="{% static 'js/vendor/datatables/DataTables-1.10.20/css/dataTables.bootstrap4.min.css' %}">
<link rel="stylesheet" href="{% static 'js/vendor/datatables/Select-1.3.1/css/select.bootstrap4.min.css' %}">
<link rel="stylesheet" href="{% static 'js/vendor/jquery-ui/jquery-ui-1.12.1/jquery-ui.min.css' %}">
<link rel="stylesheet" href="{% static 'css/vendor/yadcf/jquery.dataTables.yadcf.css' %}">
{% endblock %}
{% block head-javascript %}
<script src="{% static 'js/vendor/jquery/jquery-3.4.1.min.js' %}"></script>
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'js/vendor/jquery-ui/jquery-ui-1.12.1/jquery-ui.min.js' %}"></script>
<script src="{% static 'js/vendor/datatables/datatables.min.js' %}"></script>
<script src="{% static 'js/vendor/yadcf/jquery.dataTables.yadcf.js' %}"></script>
{% endblock %}
{% block title %}
{% trans "Trainings statistics" %}
{% endblock %}

{% block section_title %}
  <h3>{% trans "Registrations statistics by trainings" %}</h3>
{% endblock %}

{% block content %}
<div class="container-fluid" style="padding-top:20px;">
  <div class="card">
    <div class="card-header text-white bg-secondary">
      {% trans "Registrations statistics by trainings" %}
    </div>
    <div class="card-body">
      <table id="statistics_table" class="table table-sm table-striped table-bordered compact nowrap dt-body-nowrap" cellspacing="0" width="100%">
        <thead>
          <tr>
            <th id="training_filter" class="align-top">{% trans 'Training' %}</th>
            <th id="subdomain_filter" class="align-top">{% trans 'Subdomain' %}</th>
            <th id="domain_filter" class="align-top">{% trans 'Domain' %}</th>
            <th class="align-top">{% trans 'Students cnt' %}</th>
            <th class="align-top">{% trans 'Students cnt' %}<br />{{ levels.0.1 }}</th>
            <th class="align-top">{% trans 'Students cnt' %}<br />{{ levels.1.1 }}</th>
            <th class="align-top">{% trans 'Students cnt' %}<br />{{ levels.2.1 }}</th>
            <th class="align-top">{% trans 'Registrations' %}</th>
            <th class="align-top">{% trans 'Registrations' %}<br />{{ levels.0.1 }}</th>
            <th class="align-top">{% trans 'Registrations' %}<br />{{ levels.1.1 }}</th>
            <th class="align-top">{% trans 'Registrations' %}<br />{{ levels.2.1 }}</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<script type="text/javascript">
  var dt;

  $(document).ready(function () {
    $.fn.dataTableExt.errMode = 'console';
    dt = $('#statistics_table').DataTable({
      'processing': false,
      'order': [
        [0, "asc"],
        [1, "asc"],
        [2, "asc"],
      ],
      'pageLength': 15,
      'lengthMenu': [[5, 10, 25, -1], [5, 10, 25, "{% trans 'All' %}"]],
      'serverSide': false,
      'responsive': true,
      'ajax': {
        url: "/charts/get_trainings_charts",
        dataSrc: function (json) {
          if (json['data'] != undefined) {
            return json['data'];
          }
        }
      },
    'searching': true,
    'language': {
        url: "{% static 'js/vendor/i18n/' %}{{LANGUAGE_CODE}}.json"
    },
    'columns': [
      { "data": "training_label" },
      { "data": "subdomain_label" },
      { "data": "domain_label" },
      { "data": "unique_students" },
      { "data": "unique_students_lvl1" },
      { "data": "unique_students_lvl2" },
      { "data": "unique_students_lvl3" },
      { "data": "all_registrations" },
      { "data": "registrations_lvl1" },
      { "data": "registrations_lvl2" },
      { "data": "registrations_lvl3" },
    ],
    "columnDefs": [
      {
        "defaultContent": "",
        "targets": "_all",
        "className": "all",
      },
      {
        "orderable": false, "targets": [3,4,5,6,7,8,9,10],
      },
    ],
  });

  // All filters reset action
  $('#filters_reset_all').click(function () {
    yadcf.exResetAllFilters(dt);
  });

  // Filters init
  yadcf.init(dt, [
    {
      column_number: 0,
      filter_default_label: "",
      filter_match_mode: "exact",
      filter_container_id: "training_filter",
      style_class: "form-control form-control-sm",
      filter_reset_button_text: false,
    }, {
      column_number: 1,
      filter_default_label: "",
      filter_match_mode: "exact",
      filter_container_id: "subdomain_filter",
      style_class: "form-control form-control-sm",
      filter_reset_button_text: false,
    }, {
      column_number: 2,
      filter_default_label: "",
      filter_match_mode: "exact",
      filter_container_id: "domain_filter",
      style_class: "form-control form-control-sm",
      filter_reset_button_text: false,
    },
  ]);
});
</script>
{% endblock %}
