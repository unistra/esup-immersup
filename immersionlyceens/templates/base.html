<!DOCTYPE html>
{% load static %}
{% load staticfiles %}
{% load i18n %}
{% load hijack_tags %}
{% load immersionlyceens_tags %}
{% general_settings_get 'CONTACT_FORM_URL' as contact_form_url %}
{% settings_get 'STAGE' as stage %}
{% settings_get 'USE_MATOMO' as use_matomo %}
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <title>{% block title %}immersionlyceens{% endblock %}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content='Direction du Numérique - Université de Strasbourg'>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/immersionlyceens.css' %}">
    <link rel="shortcut icon" href="{% static 'img/favicon-unistra-32px.png' %}" type="image/png">
    {% comment %} Fonts {% endcomment %}
    <link rel="stylesheet" href="{% static 'fonts/fontawesome/4.7.0/css/font-awesome.css' %}">
    {% comment %} TODO: add a boolean conditionnal statement to load or not unistra design {% endcomment %}
    <link rel="stylesheet" href="{% static 'fonts/unistra-font/1.0.0/css/unistra-font.css' %}">
    <link rel="stylesheet" href="{% static 'fonts/unistra-symbol/1.0.4/css/unistra-symbol.css' %}">
    <link rel="stylesheet" href="{% static 'fonts/nova-icons/1.0.2/css/nova-icons.css' %} ">
    <link rel="stylesheet" href="{% static 'fonts/fontawesome/4.7.0/css/font-awesome.css' %}">
    <link rel="stylesheet" href="{% static 'fonts/unistra-signature/3.0.1/css/sun.css' %}">
    <link rel="stylesheet" href="{% static 'fonts/unistra-signature/3.0.1/css/themes/sun-theme-immersion.css' %}">
    {% comment %} End of fonts {% endcomment %}
    <link rel="stylesheet" href="{% static 'css/styles-unistra.min.css' %}">
    {% block head-css %}{% endblock %}
    <script src="{% static 'js/vendor/jquery/jquery-3.4.1.min.js' %}"></script>
    <script src="{{ STATIC_URL }}/summernote/summernote-bs4.min.js"></script>
    {% if use_matomo %}
    {% settings_get 'MATOMO_URL' as matomo_url %}
    {% settings_get 'MATOMO_SITE_ID' as matomo_site_id %}
    <script>var _paq=window._paq=window._paq||[];_paq.push(['trackPageView']),_paq.push(['enableLinkTracking']),function(){var a='{{ matomo_url }}';_paq.push(['setTrackerUrl',a+'matomo.php']),_paq.push(['setSiteId','{{ matomo_site_id }}']);var e=document,t=e.createElement('script'),p=e.getElementsByTagName('script')[0];t.async=!0,t.src=a+'matomo.js',p.parentNode.insertBefore(t,p)}()</script>
    {% endif %}
    {% block head-javascript %}
    {% endblock %}
    <link rel="shortcut icon" href="{% static 'img/favicon.png' %}" type="image/png">
</head>
<body>
    {% hijack_notification %}
    {% include './fragments/main_header.html'%}
    {% include './fragments/main_menu.html'%}

    {% block section_title %}{% endblock %}

    {% if messages %}
    <div id="messages" class="container sticky-top" style="top: 50px;padding: 10px;">
      {% for message in messages %}
      {% get_bootstrap_alert_msg_css_name message.tags as alert_tag %}
      <div class="messages{% if alert_tag %} alert alert-{{ alert_tag }}{% endif %} alert-dismissible">
        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
        {{ message|safe }}
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% block content %}{% endblock %}

    {% include './modals/modal_credits.html'%}
    {% include './modals/modal_legal.html'%}
    {% if not contact_form_url %}
    {% include './modals/modal_contact_us.html'%}
    {% endif %}
    {% include './fragments/main_share.html' %}
    {% include './fragments/main_footer.html' %}
    <script src="{% static 'fonts/unistra-signature/3.0.1/js/sun.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/scripts.js' %}"></script>
    <script>
    // hide notifications messages after x seconds (see settings to set value)
    var messages = document.getElementById("messages");
    if(messages) {
      setTimeout(function(){
        messages.style.display = "none";
      }, {%  settings_get 'MESSAGES_TIMEOUT' %} );
    }

    {% if stage != 'Prod' and stage != 'Dev' %}
    const markTemplate = (name) => {
      return `<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='110px' width='110px'><text transform='translate(20, 100) rotate(-40)' fill='rgb(245,45,45)' font-size='22'>${name}</text></svg>`;
    };
    const base64Mark = btoa(markTemplate('{{ stage }}'));
    document.getElementsByTagName('header')[0].style.backgroundImage = `url("data:image/svg+xml;base64,${base64Mark}")`;
    {% endif %}
    </script>

    {% block foot-javascript %}{% endblock %}
</body>
</html>
