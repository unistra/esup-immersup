{% extends "base.html" %}

{% load i18n %}
{% load static %}
{% load staticfiles %}

{% block head-css %}
    <link rel="stylesheet" href="{% static 'js/vendor/jquery-ui/jquery-ui-1.12.1/jquery-ui.min.css' %}">
    <link rel="stylesheet" href="{% static 'js/vendor/datatables/DataTables-1.10.20/css/dataTables.jqueryui.min.css' %}">
    <link rel="stylesheet" href="{% static 'js/vendor/datatables/datatables.min.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid" style="padding-top: 20px; width: 70%;">
    <div class="card">
        <div class="card-header text-white bg-secondary">
            {% if slot %}
                {% trans 'Add a new slot' %}
            {% else %}
                {% trans 'Add a new slot' %}
            {% endif %}
        </div>
        <div class="card-body">
            <div class="row">
                ??
            </div>
            <form method="POST" class="form-group" role="form">
                {% csrf_token %}
                {{ slot_form.id }}

                <div class="form-group row">
                    <label for="training" class="col-form-label col-sm-3">{% trans 'Training' %}</label>
                    <div class="col-sm-6">
                        <select name="training" id="training">
                                <option value="" selected>{% trans 'Choose a value' %}</option>
                            {% for training in trainings %}
                                <option value="{{ training.id }}">{{ training.label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="course" class="col-form-label col-sm-3">{% trans 'Course' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.course }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="course_type" class="col-form-label col-sm-3">{% trans 'Course type' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.course_type }}
                    </div>
                </div>

                <div class="form-group row">
                    <label for="campus" class="col-form-label col-sm-3">{% trans 'Campus' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.campus }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="building" class="col-form-label col-sm-3">{% trans 'Building' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.building }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="room" class="col-form-label col-sm-3">{% trans 'Room' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.room }}
                    </div>
                </div>


                <div class="form-group row">
                    <label for="building" class="col-form-label col-sm-3">{% trans 'Date' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.date }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="start_time" class="col-form-label col-sm-3">{% trans 'Start time' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.start_time }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="end_time" class="col-form-label col-sm-3">{% trans 'End time' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.end_time }}
                    </div>
                </div>

                <!-- TEACHERS -->

                <div class="form-group row">
                    <label for="n_places" class="col-form-label col-sm-3">{% trans 'Number of places' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.n_places }}
                    </div>
                </div>

                <div class="form-group row">
                    <label for="additional_information" class="col-form-label col-sm-3">{% trans 'Additional information' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.additional_information }}
                    </div>
                </div>

                <div class="form-group row">
                    <label for="published" class="col-form-label col-sm-3">{% trans 'Published' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.published }}
                    </div>
                </div>

                <div class="form-group">
                    <button id="back" class="btn btn-danger">{% trans 'Cancel' %}</button>
                    <input type="submit" class="btn btn-primary" value="{% trans 'Save' %}">
                    <button id="duplicate_save" class="btn btn-secondary">{% trans 'Save and duplicate' %}</button>
                    <button id="save_add" class="btn btn-secondary">{% trans 'Save and add' %}</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block foot-javascript %}
<script src="{% static 'js/vendor/jquery-ui/jquery-ui-1.12.1/jquery-ui.min.js' %}"></script>
<script src="{% static 'js/core/add_slot.js' %}"></script>
<script>
$(document).ready(function(){
    $('#id_date').get(0).type = 'date';
    $('#id_start_time').get(0).type = 'time';
    $('#id_end_time').get(0).type = 'time';

    $('#training').change(function(event){
        let value = event.target.value;
        $.ajax({
            url: '/api/courses/' + value,
            success: function(data){
                if ( data['data'] && data['data'].length !== 0 ) {
                    data['data'].forEach(function(e){
                        let element = '<option value="' + e['key'] + '">' + e['value'] + '</option>';
                        $('#id_course').append(element);
                    });
                }
            }
        });
    });
});
</script>
{% endblock %}
