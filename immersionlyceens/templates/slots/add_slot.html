{% extends "base.html" %}

{% load i18n %}
{% load static %}
{% load staticfiles %}

{% block head-css %}
    <link rel="stylesheet" href="{% static 'js/vendor/jquery-ui/jquery-ui-1.12.1/jquery-ui.min.css' %}">
    <link rel="stylesheet" href="{% static 'js/vendor/datatables/DataTables-1.10.20/css/dataTables.jqueryui.min.css' %}">
    <link rel="stylesheet" href="{% static 'js/vendor/datatables/datatables.min.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid" style="padding-top: 20px; width: 70%;">
    <div class="card">
        <div class="card-header text-white bg-secondary">
            {% if slot %}
                {% trans 'modify slot' %}
            {% else %}
                {% trans 'Add a new slot' %}
            {% endif %}
        </div>
        <div class="card-body">
            <div class="row">
                ??
            </div>
            <form method="POST" action="{% url 'add_slot' %}" class="form-group" role="form">
                {% csrf_token %}
                {{ slot_form.id }}

                <div class="form-group row">
                    <label for="training" class="col-form-label col-sm-3">{% trans 'Training' %}</label>
                    <div class="col-sm-6">
                        <select name="training" id="training" class="form-control">
                            <option value="" selected>{% trans 'Choose a value' %}</option>
                            {% for training in trainings %}
                                <option value="{{ training.id }}">{{ training.label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="course" class="col-form-label col-sm-3">{% trans 'Course' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.course }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="course_type" class="col-form-label col-sm-3">{% trans 'Course type' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.course_type }}
                    </div>
                </div>

                <div class="form-group row">
                    <label for="campus" class="col-form-label col-sm-3">{% trans 'Campus' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.campus }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="building" class="col-form-label col-sm-3">{% trans 'Building' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.building }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="room" class="col-form-label col-sm-3">{% trans 'Room' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.room }}
                    </div>
                </div>


                <div class="form-group row">
                    <label for="building" class="col-form-label col-sm-3">{% trans 'Date' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.date }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="start_time" class="col-form-label col-sm-3">{% trans 'Start time' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.start_time }}
                    </div>
                </div>
                <div class="form-group row">
                    <label for="end_time" class="col-form-label col-sm-3">{% trans 'End time' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.end_time }}
                    </div>
                </div>

                <div class="form-group row">
                    <label for="teachers" class="col-form-label col-sm-3">{% trans 'Taechers' %}</label>
                    <div class="col-sm-6 ">
                        <select name="teachers" id="id_teachers" class="form-control" multiple="multiple">
                        </select>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="n_places" class="col-form-label col-sm-3">{% trans 'Number of places' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.n_places }}
                    </div>
                </div>

                <div class="form-group row">
                    <label for="additional_information" class="col-form-label col-sm-3">{% trans 'Additional information' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.additional_information }}
                    </div>
                </div>

                <div class="form-group row">
                    <label for="published" class="col-form-label col-sm-3">{% trans 'Published' %}</label>
                    <div class="col-sm-6">
                        {{ slot_form.published }}
                    </div>
                </div>

                <div class="form-group">
                    <button name="cancel" id="back" class="btn btn-danger">{% trans 'Cancel' %}</button>
                    <input name="save" type="submit" class="btn btn-primary" value="{% trans 'Save' %}">
                    <button name="duplicate" id="duplicate_save" class="btn btn-secondary">{% trans 'Save and duplicate' %}</button>
                    <button name="save_add" id="save_add" class="btn btn-secondary">{% trans 'Save and add' %}</button>
                </div>
            </form>
        </div>
    </div>
    <br>
    <br>
    <br>
</div>
{% endblock %}

{% block foot-javascript %}
<script src="{% static 'js/vendor/jquery-ui/jquery-ui-1.12.1/jquery-ui.min.js' %}"></script>
<script src="{% static 'js/core/add_slot.js' %}"></script>
<script>
$(document).ready(function(){
    function load_course(value) {
        console.log(value);
        $.ajax({
            url: '/api/get_courses_by_training/' + value,
            success: function(data){
                if ( data['data'] && data['data'].length !== 0 ) {
                    $('#id_course').html('');
                    $('#id_course').append(
                        '<option value="">{% trans 'Choose a value' %}</option>'
                    );
                    data['data'].forEach(function(e){
                        console.log(e);
                        let element = '<option value="' + e['key'] + '">' + e['label'] + '</option>';
                        $('#id_course').append(element);
                    });
                }
            }
        });
    }

    function load_buildings(value){
        $.ajax({
            url: '/api/get_buildings/' + value,
            success: function(data){
                if ( data['data'] && data['data'].length !== 0 ) {
                    $('#id_building').html('');
                    $('#id_building').append(
                        '<option value="">{% trans 'Choose a value' %}</option>'
                    );
                    data['data'].forEach(function(e){
                        console.log(e);
                        let element = '<option value="' + e['id'] + '">' + e['label'] + '</option>';
                        $('#id_building').append(element);
                    });
                }
            }
        });
    }

    function load_teachers(value) {
        $.ajax({
            url: '/api/get_course_teachers/' + value,
            success: function(data){
                console.log(data);
                if ( data['data'] && data['data'].length !== 0 ) {
                    $('#id_teachers').html('');
                    data['data'].forEach(function(e){
                        let name= '' + e['first_name'] + ' ' + e['last_name'].toUpperCase();
                        let element = '<option value="' + e['id'] + '">' + name + '</option>';
                        $('#id_teachers').append(element);
                    });
                }
            },
            error: function() {$('#id_teachers').html('');}
        });
    }

    $('#id_date').get(0).type = 'date';
    $('#id_start_time').get(0).type = 'time';
    $('#id_end_time').get(0).type = 'time';

    load_course($('#training').val());
    load_buildings($('#id_campus').val());
    load_teachers($('#id_course').val());

    $('#training').change(function(event){ load_course(event.target.value); });
    $('#id_campus').change(function(event){ load_buildings(event.target.value); });
    $('#id_course').change(function(event){ load_teachers(event.target.value); });
});
</script>
{% endblock %}
