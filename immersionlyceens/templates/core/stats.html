{% extends "base.html" %}
{% load static staticfiles i18n immersionlyceens_tags %}
{% get_current_language as LANGUAGE_CODE %}
{% block head-css %}
<link rel="stylesheet" href="{% static 'js/vendor/datatables/DataTables-1.10.20/css/dataTables.bootstrap4.min.css' %}">
<link rel="stylesheet" href="{% static 'js/vendor/datatables/Select-1.3.1/css/select.bootstrap4.min.css' %}">
<link rel="stylesheet" href="{% static 'js/vendor/jquery-ui/jquery-ui-1.12.1/jquery-ui.min.css' %}">
<link rel="stylesheet" href="{% static 'css/vendor/yadcf/jquery.dataTables.yadcf.css' %}">
{% endblock %}
{% block head-javascript %}
<script src="{% static 'js/vendor/jquery/jquery-3.4.1.min.js' %}"></script>
<script src="{% static 'js/vendor/jquery-ui/jquery-ui-1.12.1/jquery-ui.min.js' %}"></script>
<script src="{% static 'js/vendor/datatables/datatables.min.js' %}"></script>
{% comment %} Comment following line if using english ! {% endcomment %}
{% endblock %}
{% block title %}
{% trans "Statistics and extractions" %}
{% endblock %}

{% block content %}
<div class="container-fluid" style="padding-top:20px;">
  <div class="card">
    <div class="card-header text-white bg-secondary">
      {% trans "Statistics and extractions" %}
    </div>
    <div class="card-body">


      {% if request.user.is_scuio_ip_manager %}
      <div class="row">
        <label class="col-form-label col-sm-3" >{% trans 'Anonymous immersion data' %}</label>
        <button type="button" class="btn btn-primary" id="extract_anonymous">{% trans 'Extract data' %}</button>
      </div>
      {% elif request.user.is_component_manager %}
      <div class="row">
        <label class="col-form-label col-sm-3" for="component">{% trans 'Components data' %}</label>

        <select name="component" id="component" class="form-control col-sm-3">

          {% if components|length > 1 %}
            <option value="" selected>{% trans 'Choose a component' %}</option>
            {% for component in components %}
              <option value="{{ component.id }}">{{ component.label }}</option>
            {% endfor %}
          {% else %}
            {% for component in components %}
              <option value="{{ component.id }}" selected>{{ component.label }}</option>
            {% endfor %}
          {% endif %}

        </select>
        <button type="button" class="btn btn-primary ml-1" id="extract_component">{% trans 'Extract data' %}</button>
      </div>
      {% elif request.user.is_high_school_manager %}
      <div class="row">
        <label class="col-form-label col-sm-3" >{% trans 'High school data' %}</label>
        <button type="button" class="btn btn-primary" id="extract_highschool">{% trans 'Extract data' %}</button>
      </div>
      {% else %}
      <div class="alert-info">{% trans "No data extractions available for your user right." %}</div>
      {% endif %}
    </div>
  </div>
</div>


<script type="text/javascript">
$(document).ready(function(){
  function toggle_component_btn() {
    if ($('#component').val() === ''){
        $('#extract_component').prop('disabled', true);
    } else {
        $('#extract_component').prop('disabled', false);
    }
  }

  toggle_component_btn();
  $('#component').change(function(){ toggle_component_btn(); });

  $('#extract_component').click(function(event){
    let component = $('#component').val();
    let url = '/api/get_csv_components/' + component;
    window.open(url, '_blank');
  });
  $('#extract_highschool').click(function(event){
    let url = '/api/get_csv_highschool/{{ high_school_id }}';
    window.open(url, '_blank');
  });
  $('#extract_anonymous').click(function(event){
    window.open('/api/get_csv_anonymous_immersion/', '_blank');
  });
});

</script>
{% endblock %}
