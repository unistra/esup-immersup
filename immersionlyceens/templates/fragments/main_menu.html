{% load static i18n immersionlyceens_tags %}
{% authorized_groups request.user %}
{% general_settings_get 'HIGHSCHOOL_VISIT' as highschool_visit %}
<nav class="navbar navbar-expand-md navbar-light bg-light sticky-top">
  <div class="container">
    <a href="/" class="navbar-brand d-md-none">Plateforme ImmerSup</a>
    <button class="navbar-toggler btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fa fa-bars fa-fw show"></i>
        <i class="fa fa-times fa-fw hide"></i>
    </button>
    <div class="collapse navbar-collapse" id="mainNav">
      <hr class="d-md-none">
      <div class="navbar-nav flex-wrap mr-auto">
        <div class="nav-item">
          <a class="nav-link d-none d-md-block" href="/" title="{% trans 'Home' %}">
            <i class="nv nv-home d-none d-md-inline"></i>
            <span class="d-md-none">{% trans 'Home' %}</span>
          </a>
        </div>
        <div class="nav-item">
          <a class="nav-link" href="{% url 'procedure' %}">{% trans 'Procedure' %}</a>
        </div>
        <div class="nav-item">
          <a class="nav-link" href="{% url 'offer' %}">{% trans 'Offer' %}</a>
        </div>
        <div class="nav-item">
        <a class="nav-link" href="{% url 'accompanying' %}">{% trans 'Accompanying' %}</a>
        </div>
        {# ref-etab, ref-str, ref-etab-maitre, ref-lyc with postbac immersions #}
        {% if authorized_groups|in_groups:"REF-ETAB,REF-STR,REF-ETAB-MAITRE" or authorized_groups|in_groups:"REF-LYC" and user.highschool.postbac_immersion %}
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownCourses" role="button" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">
              {% trans 'Courses' %}
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownCourses">
              <a class="dropdown-item" href="{% url 'courses_list' %}">{% trans 'Courses list' %}</a>
              <a class="dropdown-item" href="{% url 'course' %}">{% trans 'New course' %}</a>
              <a class="dropdown-item" href="{% url 'slots_list' %}">{% trans 'Slots list' %}</a>
              <a class="dropdown-item" href="{% url 'slot' %}">{% trans 'New slot' %}</a>
            </div>
          </div>
        {% endif %}

        {# Visits #}
        {% if highschool_visit and authorized_groups|in_groups:"REF-ETAB,REF-STR,REF-ETAB-MAITRE" %}
        <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownVisits" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            {% trans 'Visits' %}
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownCourses">
            <a class="dropdown-item" href="{% url 'visits' %}">{% trans 'Visits list' %}</a>
            <a class="dropdown-item" href="{% url 'visits_slots' %}">{% trans 'Visits slots list' %}</a>
            <a class="dropdown-item" href="{% url 'add_visit_slot' %}">{% trans 'New visit slot' %}</a>
          </div>
        </div>
        {% endif %}

        {# Off offer events #}
        {% if authorized_groups|in_groups:"REF-ETAB,REF-STR,REF-ETAB-MAITRE" or authorized_groups|in_groups:"REF-LYC" and user.highschool.postbac_immersion %}
        <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownEvents" role="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            {% trans 'Events' %}
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdownCourses">
            <a class="dropdown-item" href="{% url 'off_offer_events' %}">{% trans 'Off offer events list' %}</a>
            <a class="dropdown-item" href="{% url 'off_offer_events_slots' %}">{% trans 'Off offer events slots list' %}</a>
            <a class="dropdown-item" href="{% url 'add_off_offer_event_slot' %}">{% trans 'New off offer event slot' %}</a>
          </div>
        </div>
        {% endif %}

        {# Structure #}
        {% if authorized_groups|in_groups:"REF-STR" %}
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownStructures" role="button" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">
              {% trans 'Structures' %}
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownStructures">
              <a class="dropdown-item" href="{% url 'structure' %}">{% trans 'Update structures settings' %}</a>
            </div>
          </div>
        {% endif %}
        {# Speaker #}
        {% if authorized_groups|in_groups:"INTER" %}
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownConsultSpeaker" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              {% trans 'Consult' %}
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownConsultSpeaker">
              <a class="dropdown-item" href="{% url 'mycourses' %}">{% trans 'My courses' %}</a>
              <a class="dropdown-item" href="{% url 'myslots' slots_type='courses' %}">{% trans 'My courses slots' %}</a>
              <a class="dropdown-item" href="{% url 'myvisits' %}">{% trans 'My visits' %}</a>
              <a class="dropdown-item" href="{% url 'myslots' slots_type='visits' %}">{% trans 'My visits slots' %}</a>
              <a class="dropdown-item" href="{% url 'myevents' %}">{% trans 'My events' %}</a>
              <a class="dropdown-item" href="{% url 'myslots' slots_type='events' %}">{% trans 'My events slots' %}</a>
            </div>
          </div>
        {% endif %}
        {# Students #}
        {% if authorized_groups|in_groups:"LYC,ETU" %}
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownConsultStudent" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              {% trans 'Consult' %}
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownConsultStudent">
              {% if authorized_groups|in_groups:"LYC" %}
                <a class="dropdown-item" href="{% url 'immersion:hs_record' %}">{% trans 'My record' %}</a>
              {% elif authorized_groups|in_groups:"ETU" %}
                <a class="dropdown-item" href="{% url 'immersion:student_record' %}">{% trans 'My record' %}</a>
              {% endif %}
              <a class="dropdown-item" href="{% url 'immersion:immersions' %}">{% trans 'My immersions' %}</a>
            </div>
          </div>
        {% endif %}

        {% if not user.is_superuser %}
          {% if authorized_groups|in_groups:"REF-LYC,REF-ETAB,SRV-JUR,REF-ETAB-MAITRE" %}
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownHighSchool" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                {% if authorized_groups|in_groups:"REF-LYC" %}
                  {% trans 'High school' %}
                {% elif authorized_groups|in_groups:"REF-ETAB,REF-ETAB-MAITRE,SRV-JUR" %}
                  {% trans 'Registered users' %}
                {% endif %}
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownHighSchool">
                {% if authorized_groups|in_groups:"REF-LYC" %}
                  <a class="dropdown-item" href="{% url 'my_high_school' user.highschool.id %}">{% trans 'My high school' %}</a>
                  {% if user.highschool.postbac_immersion %}
                    <a class="dropdown-item" href="{% url 'my_high_school_speakers' user.highschool.id %}">{% trans 'My high school speakers' %}</a>
                    <a class="dropdown-item" href="{% url 'training_list' %}">{% trans 'Trainings list' %}</a>
                    <a class="dropdown-item" href="{% url 'training_add' %}">{% trans 'New training' %}</a>
                  {% endif %}
                  <a class="dropdown-item" href="{% url 'my_students' %}">{% trans 'View all registrants' %}</a>
                  <a class="dropdown-item" href="{% url 'student_validation' user.highschool.id %}">{% trans 'Validate student profiles' %}</a>
                {% endif %}
                {% if authorized_groups|in_groups:"REF-ETAB,REF-ETAB-MAITRE" %}
                  <a class="dropdown-item" href="{% url 'my_students' %}">{% trans 'View all students' %}</a>
                {% endif %}
                {% if authorized_groups|in_groups:"REF-ETAB,SRV-JUR,REF-ETAB-MAITRE" %}
                  <a class="dropdown-item" href="{% url 'students_presence' %}">{% trans 'View students by date' %}</a>
                {% endif %}
                {% if authorized_groups|in_groups:"REF-ETAB,REF-ETAB-MAITRE" %}
                  <a class="dropdown-item" href="{% url 'duplicates' %}">{% trans 'View potential duplicates' %}</a>
                  <a class="dropdown-item" href="{% url 'student_validation_global' %}">{% trans 'Validate student profiles' %}</a>
                {% endif %}

              </div>
            </div>
          {% endif %}
        {% endif %}
        {# charts #}
        {% if authorized_groups|in_groups:"REF-LYC,REF-ETAB,REF-ETAB-MAITRE" %}
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownStats" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              {% trans 'Charts' %}
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownStats">
              <a class="dropdown-item" href="{% url 'charts:highschool_charts' %}">{% trans 'Highschool registrations/participations' %}</a>
              <a class="dropdown-item" href="{% url 'charts:highschool_domains_charts' %}">{% trans 'By domains registrations' %}</a>
              <a class="dropdown-item" href="{% url 'charts:trainings_charts' %}">{% trans 'Highshcool - registrations by trainings' %}</a>
              {% if authorized_groups|in_groups:"REF-ETAB,REF-ETAB-MAITRE" %}
              <a class="dropdown-item" href="{% url 'charts:global_registrations_charts' %}">{% trans 'Registrations and participation' %}</a>
              <a class="dropdown-item" href="{% url 'charts:global_domains_charts' %}">{% trans 'Hosts - registrations by domains' %}</a>
              <a class="dropdown-item" href="{% url 'charts:global_slots_charts' %}">{% trans 'Hosts - registrations by structures' %}</a>
              {% endif %}
            </div>
          </div>
        {% endif %}
        {# stats #}
        {% if authorized_groups|in_groups:"REF-LYC,REF-ETAB,REF-STR,REF-ETAB-MAITRE" %}
        <div class="nav-item">
          <a class="nav-link" href="{% url 'stats' %}">{% trans 'Extractions' %}</a>
        </div>
        {% endif %}
        {# admin #}
        {% if user.is_staff %}
        <div class="nav-item">
          <a class="nav-link" href="{% url 'admin:index' %}">{% trans 'Administration' %}</a>
        </div>
        {% endif %}
      </div>
      {# user menu bar #}
      <div class="navbar-nav">
        <div class="nav-item dropdown dropdown-menu-right">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="navbarDropdownUser">
            <i class="fa fas fa-user"></i>
            {% if user.is_authenticated %}
              {% if request.user.get_full_name %}{{ request.user.get_full_name }}{% else %}{{ request.user.username }}{% endif %}
              <span class="caret"></span>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownUser">
              <span class="dropdown-item text-right">
                {% trans "Profile" %} :
                <strong>{% if user.is_superuser %}{% trans "Admin" %}<br />{% endif %}{{ request.user.groups.all|join:", "}}</strong>
              </span>
              <span class="dropbown-divider"></span>
              {% if authorized_groups|in_groups:"LYC,REF-LYC" %}
              <div class="dropdown-item text-right">
                <a class="text-decoration-none" href="{% url 'immersion:change_password' %}">
                  <i class="fa fas fa-key"></i> {% trans "Change password" %}
                </a>
              </div>
              {% endif %}
              <div class="dropdown-item text-right">
                <a class="text-decoration-none" href="{% url 'django_cas:logout' %}">
                  <i class="fa fas fa-sign-out"></i> {% trans "Logout" %}
                </a>
              </div>
            </div>
          {% else %}
            {% trans 'Sign in' %}
            <span class="caret"></span>
            </a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
              <span class="dropdown-item text-center">{% trans "You are"%} : </span>
              <a class="dropdown-item" href="{% url 'django_cas:login' %}">{% trans 'University member' %}</a>
              <a class="dropdown-item" href="{% url 'immersion:login' profile='ref-lyc' %}">{% trans 'Highschool manager' %}</a>
              <a class="dropdown-item" href="{% url 'immersion:login' %}">{% trans 'Highschool member' %}</a>
              <a class="dropdown-item" href="{% url 'shibboleth_login' %}">{% trans 'Student' context "login" %}</a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</nav>

