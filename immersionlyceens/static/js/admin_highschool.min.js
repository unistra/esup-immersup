$(document).on("change","select#id_department",function(){$.ajax({url:`/geoapi/cities/${$(this).val()}`,type:"GET",success(data){let options='<option value="">---------</option>';for(let i=0;i<data.length;i++){options+=`<option value="${data[i][0]}">${data[i][0]}</option>`}$("select#id_city").html(options)}});$("select#id_zip_code").html('<option value="">---------</option>')});$(document).on("change","select#id_city",()=>{$.ajax({url:`/geoapi/zipcodes/${$("select#id_department").val()}/${$("select#id_city").val()}`,type:"GET",success(data){var options='<option value="">---------</option>';if(data.length===1){options=`<option value="${data[0][0]}">${data[0][0]}</option>`}else{for(let i=0;i<data.length;i++){options+=`<option value="${data[i][0]}">${data[i][0]}</option>`}}$("select#id_zip_code").html(options)}})});$(document).on("change","select#id_country",function(){if($(this).val()!="FR"){$("select#id_department").replaceWith('<input class="form-control" type="text" name="department" id="id_department">');$("select#id_city").replaceWith('<input class="form-control" type="text" name="city" id="id_city">');$("select#id_zip_code").replaceWith('<input class="form-control" type="text" name="zip_code" id="id_zip_code">')}else{$("#id_department").replaceWith('<select name="department" id="id_department"></select>');$("#id_city").replaceWith('<select name="city" id="id_city"></select>');$("#id_zip_code").replaceWith('<select name="zip_code" id="id_zip_code"></select>');$.ajax({url:`/geoapi/departments`,type:"GET",success(data){let options='<option value="">---------</option>';for(let i=0;i<data.length;i++){options+=`<option value="${data[i][0]}">${data[i][1]}</option>`}$("select#id_department").html(options)}});$("select#id_city").html('<option value="">---------</option>');$("select#id_zip_code").html('<option value="">---------</option>')}});$(document).on("change","input#id_with_convention",function(){$("#id_convention_start_date").prop("disabled",!$(this).is(":checked"));$("#id_convention_start_date").prop("required",$(this).is(":checked"));$("#id_convention_end_date").prop("disabled",!$(this).is(":checked"));$("#id_convention_end_date").prop("required",$(this).is(":checked"));$(".field-convention_start_date").toggle($(this).is(":checked")===true);$(".field-convention_end_date").toggle($(this).is(":checked")===true)});$(document).on("change","input#id_uses_student_federation",function(){$("#id_uai_code").prop("required",$(this).is(":checked"))});$(document).ready(function(){var uai_results=Object();function toggle_fields(){if($("#id_postbac_immersion").is(":checked")){$("#id_mailing_list").attr("disabled",false);$("div.field-badge_html_color").show();$("#id_logo").attr("required",false);$("div.field-logo").show();$("div.field-signature").show();$("div.field-certificate_header").show();$("div.field-certificate_footer").show()}else{$("#id_mailing_list").attr("disabled",true);$("div.field-badge_html_color").hide();$("#id_logo").attr("required",true);$("div.field-logo").hide();$("div.field-signature").hide();$("div.field-certificate_header").hide();$("div.field-certificate_footer").hide()}}function toggle_uai_code(){$("#id_uai_code").attr("required",$("#id_uses_student_federation").is(":checked"))}$("#id_postbac_immersion").change(function(){toggle_fields()});$("#id_uses_student_federation").change(function(){toggle_uai_code()});toggle_fields();toggle_uai_code();$(".field-convention_start_date").toggle($("#id_with_convention").is(":checked")===true);$(".field-convention_end_date").toggle($("#id_with_convention").is(":checked")===true);$("input#id_label").on("input",function(){if(!$("#id_uses_student_federation").is(":checked"))return;let search_label=$(this).val();$("#id_uai_code").replaceWith('<select name="uai_code" id="id_uai_code"></select>');$("#id_uai_code").attr("required",true);if(search_label.length>3){$.ajax({url:`/uaiapi/establishments/${search_label}`,type:"GET",success(data){let option_txt="";let options='<option value="">---------</option>';$.each(data,function(item,establishment){uai_results[establishment["code"]]=establishment["label"];option_txt=establishment["city"]!==""?establishment["city"]:"";option_txt+=establishment["academy"]!==""?` (ac. ${establishment["academy"]})`:"";option_txt+=option_txt!==""?" - ":"";option_txt+=`${establishment["code"]} - ${establishment["label"]}`;options+=`<option value="${establishment["code"]}">${option_txt}</option>`});$("select#id_uai_code").html(options)}})}});$(document).on("change","#id_uai_code",function(){if(!$("#id_uses_student_federation").is(":checked"))return;if(uai_results[this.value]!==undefined){$("#id_label").val(uai_results[this.value])}})});
