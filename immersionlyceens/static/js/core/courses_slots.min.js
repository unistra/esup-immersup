function init_datatable(){show_duplicate_btn=!("boolean"==typeof show_duplicate_btn&&!show_duplicate_btn)||show_duplicate_btn,show_delete_btn=!("boolean"==typeof show_delete_btn&&!show_delete_btn)||show_delete_btn,show_modify_btn=!("boolean"==typeof show_modify_btn&&!show_modify_btn)||show_modify_btn,cohorts_only=!("boolean"!=typeof cohorts_only||!cohorts_only)&&cohorts_only,current_slots_only=!("boolean"!=typeof current_slots_only||!current_slots_only)&&current_slots_only;var t="";if(cohorts_only){t=[{data:"id",render:function(t,e,r){let l="",a=0;return(r.structure_code&&r.structure_managed_by_me||r.highschool_label&&r.highschool_managed_by_me||cohorts_only)&&(show_duplicate_btn&&(l+=`<a href="/core/slot/${t}/1" class="btn btn-light btn-sm mr-1" `+`title="${duplicate_text}"><i class="fa far fa-copy fa-2x centered-icon"></i></a>`),!1===r.is_past&&show_modify_btn&&(l+=`<a href="/core/slot/${t}" class="btn btn-light btn-sm mr-1" title="${modify_text}"><i class="fa fas fa-pencil fa-2x centered-icon"></i></a>\n`),0===r.n_register&&0===r.n_group_register&&!1===r.is_past&&show_delete_btn&&(l+=`<button class="btn btn-light btn-sm mr-1" onclick="deleteDialog.data('slot_id', ${t}).dialog('open')" title="${delete_text}"><i class="fa fas fa-trash fa-2x centered-icon"></i></button>\n`),!1===cohorts_only&&!0===r.is_past&&(r.n_register>0||r.n_group_register>0)?(a=1,l+=`<button class="btn btn-light btn-sm mr-1" name="edit" onclick="open_modal(${t}, ${a}, ${r.n_places}, ${r.allow_individual_registrations}, ${r.allow_group_registrations}, ${r.group_mode}, ${r.n_group_places}, ${r.is_past}, ${r.can_update_registrations}, ${r.place})" title="${attendances_text}">`+"<i class='fa fas fa-edit fa-2x centered-icon'></i></button>"):(r.attendances_value===attendance_not_yet||r.attendances_value===attendance_nothing_to_enter||r.n_register>0||r.n_group_register>0)&&(l+=`<button class="btn btn-light btn-sm mr-1" name="view" onclick="open_modal(${t}, ${a}, ${r.n_places}, ${r.allow_individual_registrations}, ${r.allow_group_registrations}, ${r.group_mode}, ${r.n_group_places}, ${r.is_past}, ${r.can_update_registrations}, ${r.place})" title="${registered_text}">`+"<i class='fa fas fa-eye fa-2x centered-icon'></i></button>"),!0===cohorts_only&&(l+=`<span data-toggle="tooltip" data-html="true" data-contrainer="body" title="${registration_date_limit_txt} : <br>${formatDate(r.registration_limit_date)}">`+'<i class="fa fas fa-calendar pr-2"></i></span>')),l}},{data:"structure_code",render:function(t,e,r){if(r.structure_code)return`${r.establishment_code} - ${r.structure_code}`;if(r.highschool_label){let t=is_set(r.highschool_city)?r.highschool_city:no_city_txt;return`${t} - ${r.highschool_label}`}return""}},{data:"course_training_label"},{data:"course_id",render:function(t,e,r){let l="",a=is_set(r.course_label)?r.course_label:"";return"filter"===e?`${a.normalize("NFD").replace(/\p{Diacritic}/gu,"")} (${r.course_type_label})`:(l=r.structure_code&&r.structure_managed_by_me||r.highschool_label&&r.highschool_managed_by_me?`<a href="/core/course/${r.course_id}">${r.course_label} (${r.course_type_label})</a>`:`${r.course_label} (${r.course_type_label})`,l)}},{data:"date",render:function(t,e,r){return display_slot_date(t,e,r)}},{data:"campus_label",render:function(t,e,r){let l=t,a=r.building_label,n=r.room,o=is_set(l)?l:"";return o+=""!==o?"<br>":"",o+=is_set(a)?a:"",o+=""!==o?"<br>":"",o+=is_set(n)?n:"","filter"===e?o.normalize("NFD").replace(/\p{Diacritic}/gu,""):o}},{data:"speaker_list",render:function(t,e,r){return display_slot_speakers(t,e,r)}},{data:"n_register",render:function(t,e,r){return display_n_register(t,e,r,!0)}},{data:"additional_information",render:function(t){return display_additional_information(t)}},{data:"",render:function(t,e,r){return display_slot_restrictions(t,e,r)}}],yadcf_filters=[{column_number:1,filter_default_label:"",filter_match_mode:"exact",style_class:"form-control form-control-sm",filter_container_id:"managed_by_filter",filter_reset_button_text:!1},{column_number:2,filter_default_label:"",filter_match_mode:"exact",filter_container_id:"training_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1},{column_number:4,filter_type:"text",filter_default_label:"",filter_container_id:"date_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1},{column_number:7,filter_type:"text",filter_default_label:"",filter_container_id:"registration_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1}];var e=[3,5,6],r={3:course_label_filter};e=[3,5,6]}else{t=[{data:"id",render:function(t,e,r){let l="",a=0;return(r.structure_code&&r.structure_managed_by_me||r.highschool_label&&r.highschool_managed_by_me||cohorts_only)&&(show_duplicate_btn&&(l+=`<a href="/core/slot/${t}/1" class="btn btn-light btn-sm mr-1" `+`title="${duplicate_text}"><i class="fa far fa-copy fa-2x centered-icon"></i></a>`),!1===r.is_past&&show_modify_btn&&(l+=`<a href="/core/slot/${t}" class="btn btn-light btn-sm mr-1" title="${modify_text}"><i class="fa fas fa-pencil fa-2x centered-icon"></i></a>\n`),0===r.n_register&&0===r.n_group_register&&!1===r.is_past&&show_delete_btn&&(l+=`<button class="btn btn-light btn-sm mr-1" onclick="deleteDialog.data('slot_id', ${t}).dialog('open')" title="${delete_text}"><i class="fa fas fa-trash fa-2x centered-icon"></i></button>\n`),!1===cohorts_only&&!0===r.is_past&&(r.n_register>0||r.n_group_register>0)?(a=1,l+=`<button class="btn btn-light btn-sm mr-1" name="edit" onclick="open_modal(${t}, ${a}, ${r.n_places}, ${r.allow_individual_registrations}, ${r.allow_group_registrations}, ${r.group_mode}, ${r.n_group_places}, ${r.is_past}, ${r.can_update_registrations}, ${r.place})" title="${attendances_text}">`+"<i class='fa fas fa-edit fa-2x centered-icon'></i></button>"):(r.attendances_value===attendance_not_yet||r.attendances_value===attendance_nothing_to_enter||r.n_register>0||r.n_group_register>0)&&(l+=`<button class="btn btn-light btn-sm mr-1" name="view" onclick="open_modal(${t}, ${a}, ${r.n_places}, ${r.allow_individual_registrations}, ${r.allow_group_registrations}, ${r.group_mode}, ${r.n_group_places}, ${r.is_past}, ${r.can_update_registrations}, ${r.place})" title="${registered_text}">`+"<i class='fa fas fa-eye fa-2x centered-icon'></i></button>"),!0===cohorts_only&&(l+=`<span data-toggle="tooltip" data-html="true" data-contrainer="body" title="${registration_date_limit_txt} : <br>${formatDate(r.registration_limit_date)}">`+'<i class="fa fas fa-calendar pr-2"></i></span>')),l}},{data:"published",render:function(t,e,r){return t?yes_text:no_text}},{data:"structure_code",render:function(t,e,r){if(r.structure_code)return`${r.establishment_code} - ${r.structure_code}`;if(r.highschool_label){let t=is_set(r.highschool_city)?r.highschool_city:no_city_txt;return`${t} - ${r.highschool_label}`}return""}},{data:"course_training_label"},{data:"course_id",render:function(t,e,r){let l="",a=is_set(r.course_label)?r.course_label:"";return"filter"===e?`${a.normalize("NFD").replace(/\p{Diacritic}/gu,"")} (${r.course_type_label})`:(l=r.structure_code&&r.structure_managed_by_me||r.highschool_label&&r.highschool_managed_by_me?`<a href="/core/course/${r.course_id}">${r.course_label} (${r.course_type_label})</a>`:`${r.course_label} (${r.course_type_label})`,l)}},{data:"date",render:function(t,e,r){return display_slot_date(t,e,r)}},{data:"campus_label",render:function(t,e,r){let l=t,a=r.building_label,n=r.room,o=is_set(l)?l:"";return o+=""!==o?"<br>":"",o+=is_set(a)?a:"",o+=""!==o?"<br>":"",o+=is_set(n)?n:"","filter"===e?o.normalize("NFD").replace(/\p{Diacritic}/gu,""):o}},{data:"speaker_list",render:function(t,e,r){return display_slot_speakers(t,e,r)}},{data:"n_register",render:function(t,e,r){return display_n_register(t,e,r)}},{data:"additional_information",render:function(t){return display_additional_information(t)}},{data:"",render:function(t,e,r){return display_slot_restrictions(t,e,r)}},{data:"allow_group_registrations",render:function(t,e,r){return"display"===e?display_group_informations(r):"filter"===e||"sort"===e?set_group_filter(r,e):t}}],yadcf_filters=[{column_number:1,filter_default_label:"",filter_container_id:"published_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1},{column_number:2,filter_default_label:"",filter_match_mode:"exact",style_class:"form-control form-control-sm",filter_container_id:"managed_by_filter",filter_reset_button_text:!1},{column_number:3,filter_default_label:"",filter_match_mode:"exact",filter_container_id:"training_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1},{column_number:5,filter_type:"text",filter_default_label:"",filter_container_id:"date_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1},{column_number:8,filter_type:"text",filter_default_label:"",filter_container_id:"registration_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1},{column_number:11,filter_default_label:"",filter_match_mode:"exact",filter_container_id:"groups_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1}];e=[4,6,7],r={4:course_label_filter},e=[4,6,7]}dt=$("#slots_list").DataTable({ajax:{url:"/core/utils/slots",data:function(t){return(is_set(current_establishment_id)||$("#id_establishment").val())&&(t.establishment_id=current_establishment_id||$("#id_establishment").val()),(is_set(current_training_id)||$("#id_training").val())&&(t.training_id=current_training_id||$("#id_training").val()),is_set(current_structure_id)||$("#id_structure").val()?t.structure_id=current_structure_id||$("#id_structure").val():(is_set(current_highschool_id)||$("#id_highschool").val())&&(t.highschool_id=current_highschool_id||$("#id_highschool").val()),cohorts_only&&(t.cohorts_only=cohorts_only),current_slots_only&&(t.current_slots_only=current_slots_only),t.past=$("#filter_past_slots").is(":checked"),t},dataSrc:function(t){return void 0!==t.data&&0!==t.data.length?t.data:[]}},order:[[5,"asc"]],processing:!1,serverSide:!1,responsive:!1,info:!1,searching:!0,searchCols:[null,null,null,null,{search:course_label_filter.normalize("NFD").replace(/\p{Diacritic}/gu,"")},null,null,null,null,null],paging:!0,ordering:!0,language:{url:language_file},columns:t,columnDefs:[{defaultContent:"-",targets:"_all"}],initComplete:function(){var t=this.api();e.forEach(function(e){var l=t.column(e),a=l.header().id,n=$(`#${a}`),o=`${a}_input`,i=$(n).text();$(n).html(i+`<div><input id="${o}" class="form-control form-control-sm" type="text" style="padding: 3px 4px 3px 4px"/></div>`),$(`#${o}`).click(function(t){t.stopPropagation()}),e in r&&$(`#${o}`).val(r[e]),$(`#${o}`).off("keyup change").on("keyup change",function(r){r.stopPropagation(),$(this).attr("title",$(this).val());var l=this.selectionStart;t.column(e).search(""!==this.value?this.value.normalize("NFD").replace(/\p{Diacritic}/gu,""):"",""!==this.value,""===this.value).draw(),$(this).focus()[0].setSelectionRange(l,l)})})}}),$("#filters_reset_all").click(function(){yadcf.exResetAllFilters(dt),e.forEach(function(t){let e=dt.column(t),r=e.header().id,l=`${r}_input`;$(`#${l}`).val("")}),dt.columns().search("").draw()}),$("#filter_past_slots").click(function(){dt.ajax.reload()}),dt.on("draw",function(){$('[data-toggle="tooltip"]').tooltip()}),yadcf.init(dt,yadcf_filters)}