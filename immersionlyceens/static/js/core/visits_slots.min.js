function init_datatable(){dt=$("#slots_list").DataTable({ajax:{url:"/core/utils/slots",data:function(d){d.visits=true;if(is_set(current_establishment_id)||$("#id_establishment").val()){d.establishment_id=current_establishment_id||$("#id_establishment").val()}if(is_set(current_structure_id)||$("#id_structure").val()){d.structure_id=current_structure_id||$("#id_structure").val()}d.past=$("#filter_past_slots").is(":checked");return d},dataSrc:function(json){if(json["data"]!==undefined&&json["data"].length!==0){return json["data"]}return[]}},order:[[5,"asc"],[2,"asc"],[3,"asc"],[4,"asc"]],processing:false,serverSide:false,responsive:false,info:false,search:true,searchCols:[null,null,{search:highschool_filter},{search:managed_by_filter},{search:visit_purpose_filter.normalize("NFD").replace(/\p{Diacritic}/gu,"")},null,null,null,null,null],paging:true,ordering:true,language:{url:language_file},columns:[{data:"id",render:function(data,type,row){let element="";if(row.can_update_visit_slot){element+=`<a href="/core/visit_slot/${data}/1" class="btn btn-light btn-sm mr-1" `+`title=${duplicate_text}"><i class="fa far fa-copy fa-2x centered-icon"></i></a>`;if(row.is_past===false){element+=`<a href="/core/visit_slot/${data}" class="btn btn-light btn-sm mr-1" title="${modify_text}"><i class="fa fas fa-pencil fa-2x centered-icon"></i></a>\n`}if(row.n_register===0&&row.is_past===false){element+=`<button class="btn btn-light btn-sm mr-1" onclick="deleteDialog.data('slot_id', ${data}).dialog('open')" title="${delete_text}"><i class="fa fas fa-trash fa-2x centered-icon"></i></button>\n`}if(row.attendances_value===1){element+=`<button class="btn btn-light btn-sm mr-1" name="edit" onclick="open_modal(${data}, ${row.attendances_value}, ${row.n_places}, ${row.is_past}, ${row.can_update_registrations}, ${row.face_to_face})" title="${attendances_text}">`+`<i class='fa fas fa-edit fa-2x centered-icon'></i>`+`</button>`}else if(row.attendances_value!==-1){element+=`<button class="btn btn-light btn-sm mr-1" name="view" onclick="open_modal(${data}, ${row.attendances_value}, ${row.n_places}, ${row.is_past}, ${row.can_update_registrations})" title="${registered_text}">`+`<i class='fa fas fa-eye fa-2x centered-icon'></i>`+`</button>`}}return element}},{data:"published",render:function(data,type,row){return data?yes_text:no_text}},{data:"highschool_label",render:function(data,type,row){return`${row.highschool_city} - ${data}`}},{data:"establishment_code",render:function(data,type,row){let txt=data;txt+=is_set(row.structure_code)?` - ${row.structure_code}`:"";return txt}},{data:"visit_id",render:function(data,type,row){let txt=is_set(row.visit_purpose)?row.visit_purpose:"";if(type==="filter"){return txt.normalize("NFD").replace(/\p{Diacritic}/gu,"")}if(row.can_update_visit_slot){txt=`<a href="/core/visit/${row.id}">${row.visit_purpose}</a>`}return txt}},{data:"date",render:function(data,type,row){return display_slot_date(data,type,row)}},{data:"room",render:function(data,type,row){let txt=row.face_to_face?row.room:remote_visit_text;if(type==="filter"){return txt.normalize("NFD").replace(/\p{Diacritic}/gu,"")}return txt}},{data:"speaker_list",render:function(data,type,row){return display_slot_speakers(data,type,row)}},{data:"n_register",render:function(data,type,row){return display_n_register(data,type,row)}},{data:"additional_information",render:function(data){return display_additional_information(data)}},{data:"",render:function(data,type,row){return display_slot_restrictions(data,type,row)}}],columnDefs:[{defaultContent:"-",targets:"_all"},{orderable:false,targets:[10]}],initComplete:function(){var api=this.api();var columns_idx=[4,6,7];var initial_values={4:visit_purpose_filter};columns_idx.forEach(function(col_idx){var column=api.column(col_idx);var column_header_id=column.header().id;var cell=$(`#${column_header_id}`);var filter_id=`${column_header_id}_input`;var title=$(cell).text();$(cell).html(title+`<div><input id="${filter_id}" class="form-control form-control-sm" type="text" style="padding: 3px 4px 3px 4px"/></div>`);$(`#${filter_id}`).click(function(event){event.stopPropagation()});if(col_idx in initial_values){$(`#${filter_id}`).val(initial_values[col_idx])}$(`#${filter_id}`).off("keyup change").on("keyup change",function(e){e.stopPropagation();$(this).attr("title",$(this).val());var cursorPosition=this.selectionStart;api.column(col_idx).search(this.value!==""?this.value.normalize("NFD").replace(/\p{Diacritic}/gu,""):"",this.value!=="",this.value==="").draw();$(this).focus()[0].setSelectionRange(cursorPosition,cursorPosition)})})}});$("#filters_reset_all").click(function(){yadcf.exResetAllFilters(dt);let columns_idx=[4,6,7];columns_idx.forEach(function(col_idx){let column=dt.column(col_idx);let column_header_id=column.header().id;let filter_id=`${column_header_id}_input`;$(`#${filter_id}`).val("")});dt.columns().search("").draw()});$("#filter_past_slots").click(function(){dt.ajax.reload()});dt.on("draw",function(){$('[data-toggle="tooltip"]').tooltip()});yadcf.init(dt,[{column_number:1,filter_default_label:"",filter_container_id:"published_filter",style_class:"form-control form-control-sm",filter_reset_button_text:false},{column_number:2,filter_default_label:"",filter_match_mode:"exact",filter_container_id:"highschool_filter",style_class:"form-control form-control-sm",filter_reset_button_text:false},{column_number:3,filter_default_label:"",filter_match_mode:"exact",style_class:"form-control form-control-sm",filter_container_id:"managed_by_filter",filter_reset_button_text:false},{column_number:5,filter_type:"text",filter_default_label:"",filter_container_id:"date_filter",style_class:"form-control form-control-sm",filter_reset_button_text:false},{column_number:8,filter_type:"text",filter_default_label:"",filter_container_id:"registration_filter",style_class:"form-control form-control-sm",filter_reset_button_text:false}]);if(highschool_filter||managed_by_filter||visit_purpose_filter){let filter_array=Array();if(highschool_filter){filter_array.push([2,[highschool_filter]])}if(managed_by_filter){filter_array.push([3,[managed_by_filter]])}if(visit_purpose_filter){filter_array.push([4,[visit_purpose_filter]])}yadcf.exFilterColumn(dt,filter_array)}}
