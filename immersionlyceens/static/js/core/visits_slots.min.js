function init_datatable(){if(dt=$("#slots_list").DataTable({ajax:{url:"/api/slots",data:function(t){return t.visits=!0,$("#id_establishment").val()&&(t.establishment_id=$("#id_establishment").val()),$("#id_structure").val()&&(t.structure_id=$("#id_structure").val()),t.past=$("#filter_past_slots").is(":checked"),t},dataSrc:function(t){return void 0!==t.data&&0!==t.data.length?t.data:[]}},order:[[4,"asc"],[1,"asc"],[2,"asc"],[3,"asc"]],processing:!1,serverSide:!1,responsive:!1,info:!1,search:!0,searchCols:[null,{search:highschool_filter},{search:managed_by_filter},{search:visit_purpose_filter.normalize("NFD").replace(/\p{Diacritic}/gu,"")},null,null,null,null,null,null],paging:!0,ordering:!0,language:{url:language_file},columns:[{data:"published",render:function(t,e,a){return t?yes_text:no_text}},{data:"highschool",render:function(t,e,a){return t.city+" - "+t.label}},{data:"establishment",render:function(t,e,a){let l=a.establishment.code;return a.structure&&a.structure.code&&(l+=" - "+a.structure.code),l}},{data:"visit",render:function(t,e,a){let l="";return l=a.can_update_visit_slot?'<a href="/core/visit/'+t.id+'">'+t.purpose+"</a>":t.purpose,"filter"===e?l.normalize("NFD").replace(/\p{Diacritic}/gu,""):l}},{data:"datetime",render:function(t,e,a){return"display"===e||"filter"===e?"<span>"+a.date+"</span><br><span>"+a.time.start+" - "+a.time.end+"</span>":t}},{data:"room",render:function(t,e,a){let l;return l=a.face_to_face?a.room:remote_visit_text,"filter"===e?l.normalize("NFD").replace(/\p{Diacritic}/gu,""):l}},{data:"speakers",render:function(t,e,a){let l="";return $.each(t,function(t,e){l+='<a href="mailto:'+e+'">'+t+"</a><br>"}),"filter"===e?l.normalize("NFD").replace(/\p{Diacritic}/gu,""):l}},{data:"n_register",render:function(t,e,a){let l=t,i=a.n_places;return element="<span>"+l+"/"+i+'</span><div class="progress">    <div       class="progress-bar"       role="progressbar"       aria-valuenow="'+l+'"       aria-valuemin="0"       aria-valuemax="'+i+'"       style="width: '+Math.round(l/i*100)+'%"></div></div>',element}},{data:"additional_information",render:function(t){return t?'<span data-toggle="tooltip" title="'+t+'"><i class="fa fas fa-info-circle fa-2x centered-icon"></i></span>':""}},{data:"restrictions",render:function(t){let e="",a="",l="",i="",n="",r="";return!0===t.establishment_restrictions&&(e+=establishments_txt+" :\n",t.allowed_establishments.forEach(t=>{e+="- "+t+"\n"}),t.allowed_highschools.forEach(t=>{e+="- "+t+"\n"})),!0===t.levels_restrictions&&(a+=levels_txt+" :\n",t.allowed_highschool_levels.forEach(t=>{a+="- "+t+"\n"}),t.allowed_post_bachelor_levels.forEach(t=>{a+="- "+t+"\n"}),t.allowed_student_levels.forEach(t=>{a+="- "+t+"\n"})),!0===t.bachelors_restrictions&&(t.allowed_bachelor_types.length>0&&(i+=bachelors_txt+" :\n",t.allowed_bachelor_types.forEach(t=>{i+="- "+t+"\n"})),t.allowed_bachelor_mentions.length>0&&(n+="\n"+allowed_mentions_txt+" :\n",t.allowed_bachelor_mentions.forEach(t=>{n+="- "+t+"\n"})),t.allowed_bachelor_teachings.length>0&&(r+="\n"+allowed_teachings_txt+" :\n",t.allowed_bachelor_teachings.forEach(t=>{r+="- "+t+"\n"}))),e.length>0&&(l+='<li data-toggle="tooltip" data-container="body" title="'+e+'"><i class="fa fas fa-info-circle fa-fw"></i> '+establishments_txt+"</li>"),a.length>0&&(l+='<li data-toggle="tooltip" data-container="body" title="'+a+'"><i class="fa fas fa-info-circle fa-fw"></i> '+levels_txt+"</li>"),i.length>0&&(l+='<li data-toggle="tooltip" data-container="body" title="'+i+'"><i class="fa fas fa-info-circle fa-fw"></i> '+bachelors_txt+"</li>"),n.length>0&&(l+='<li data-toggle="tooltip" data-container="body" title="'+n+'"><i class="fa fas fa-info-circle fa-fw"></i> '+allowed_mentions_txt+"</li>"),r.length>0&&(l+='<li data-toggle="tooltip" data-container="body" title="'+r+'"><i class="fa fas fa-info-circle fa-fw"></i> '+allowed_teachings_txt+"</li>"),'<ul class="list-unstyled">'+l+"<ul>"}},{data:"id",render:function(t,e,a){if(a.can_update_visit_slot){let e='  <a href="/core/visit_slot/'+t+'/1" class="btn btn-light btn-sm mr-1"   title="'+duplicate_text+'"><i class="fa far fa-copy fa-2x centered-icon"></i></a>';return!1===a.is_past&&(e+='<a href="/core/visit_slot/'+t+'" class="btn btn-light btn-sm mr-1" title="'+modify_text+'"><i class="fa fas fa-pencil fa-2x centered-icon"></i></a>\n'),0===a.n_register&&!1===a.is_past&&(e+='<button class="btn btn-light btn-sm mr-1" onclick="deleteDialog.data(\'slot_id\', '+t+").dialog('open')\" title=\""+delete_text+'"><i class="fa fas fa-trash fa-2x centered-icon"></i></button>\n'),1===a.attendances_value?e+='<button class="btn btn-light btn-sm mr-1" name="edit" onclick="open_modal('+t+","+a.attendances_value+","+a.n_places+","+a.is_past+","+a.can_update_registrations+","+a.face_to_face+')" title="'+attendances_text+"\"><i class='fa fas fa-edit fa-2x centered-icon'></i></button>":-1!==a.attendances_value&&(e+='<button class="btn btn-light btn-sm mr-1" name="view" onclick="open_modal('+t+","+a.attendances_value+","+a.n_places+","+a.is_past+","+a.can_update_registrations+')" title="'+registered_text+"\"><i class='fa fas fa-eye fa-2x centered-icon'></i></button>"),e+="</div>",e}return""}}],columnDefs:[{defaultContent:"-",targets:"_all"},{orderable:!1,targets:[9]}],initComplete:function(){var t=this.api(),e=[3,5,6],a={3:visit_purpose_filter};e.forEach(function(e){var l=t.column(e),i=l.header().id,n=$(`#${i}`),r=`${i}_input`,s=$(n).text();$(n).html(s+`<div><input id="${r}" class="form-control form-control-sm" type="text" style="padding: 3px 4px 3px 4px"/></div>`),$(`#${r}`).click(function(t){t.stopPropagation()}),e in a&&$(`#${r}`).val(a[e]),$(`#${r}`).off("keyup change").on("keyup change",function(a){a.stopPropagation(),$(this).attr("title",$(this).val());var l=this.selectionStart;t.column(e).search(""!==this.value?this.value.normalize("NFD").replace(/\p{Diacritic}/gu,""):"",""!==this.value,""===this.value).draw(),$(this).focus()[0].setSelectionRange(l,l)})})}}),$("#filters_reset_all").click(function(){yadcf.exResetAllFilters(dt);let t=[3,5,6];t.forEach(function(t){let e=dt.column(t),a=e.header().id,l=`${a}_input`;$(`#${l}`).val("")}),dt.columns().search("").draw()}),$("#filter_past_slots").click(function(){dt.ajax.reload()}),yadcf.init(dt,[{column_number:0,filter_default_label:"",filter_container_id:"published_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1},{column_number:1,filter_default_label:"",filter_match_mode:"exact",filter_container_id:"highschool_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1},{column_number:2,filter_default_label:"",filter_match_mode:"exact",style_class:"form-control form-control-sm",filter_container_id:"managed_by_filter",filter_reset_button_text:!1},{column_number:4,filter_type:"text",filter_default_label:"",filter_container_id:"date_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1},{column_number:7,filter_type:"text",filter_default_label:"",filter_container_id:"registration_filter",style_class:"form-control form-control-sm",filter_reset_button_text:!1}]),highschool_filter||managed_by_filter||visit_purpose_filter){let t=Array();highschool_filter&&t.push([1,[highschool_filter]]),managed_by_filter&&t.push([2,[managed_by_filter]]),visit_purpose_filter&&t.push([3,[visit_purpose_filter]]),yadcf.exFilterColumn(dt,t)}}