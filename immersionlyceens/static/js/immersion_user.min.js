function getCookie(name){var cookieValue=null;if(document.cookie&&document.cookie!=""){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=django.jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}}return cookieValue}window.addEventListener("load",function(){(function($){let query_order=0;let results;let establishment_id;let results_text=gettext("Results");let select_text=gettext("Select a user ...");$(document).ready(function(){$("#id_establishment").on("change",function(){establishment_id=this.value});$("#id_username").after("<label id='livesearch_label'>"+results_text+" :</label>"+"<select id='live_select' style='visibility:hidden'></select>"+"<label id='ws_message' style='display:none; width:300px;'></label>");$("#id_username").on("input",function(){if(this.value.length>=2){let csrftoken=getCookie("csrftoken");query_order+=1;$.ajax({beforeSend:function(request){request.setRequestHeader("X-CSRFToken",csrftoken)},url:"/api/get_person",type:"POST",data:{username:this.value,establishment_id:establishment_id,query_order:query_order},success:function(json){var msg=json["msg"];var query=json["data"][0];if(msg!=""){document.getElementById("ws_message").innerHTML=msg;$("#ws_message").show()}else{document.getElementById("ws_message").innerHTML="";$("#ws_message").hide()}if(query>=query_order){document.getElementById("livesearch_label").style.visibility="visible";document.getElementById("live_select").style.visibility="visible";if(json["data"].length<=1){$("#id_email").val("");$("#id_first_name").val("");$("#id_last_name").val("")}else{results=json["data"];$("#live_select").empty().append("<option value=''>"+select_text+"</option>");for(var i=1;i<json["data"].length;i++){$("#live_select").append("<option value='"+i+"'>"+json["data"][i]["display_name"]+"</option>")}}}},error:function(e){obj=JSON.stringify(e);console.log("Error : "+obj)}})}else{document.getElementById("live_select").style.visibility="hidden";document.getElementById("livesearch_label").style.visibility="hidden";$("#id_email").val("");$("#id_first_name").val("");$("#id_last_name").val("")}});$("#live_select").on("change",function(e,json){var optionSelected=$("option:selected",this);var valueSelected=this.value;if(this.value!=""){$("#id_username").val(results[valueSelected]["username"]);$("#id_email").val(results[valueSelected]["email"]);$("#id_first_name").val(results[valueSelected]["firstname"]);$("#id_last_name").val(results[valueSelected]["lastname"])}else{$("#id_username").val("");$("#id_email").val("");$("#id_first_name").val("");$("#id_last_name").val("")}})})})(django.jQuery)});
