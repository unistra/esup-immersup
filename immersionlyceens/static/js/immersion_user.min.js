function getCookie(e){var i=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),l=0;l<t.length;l++){var a=django.jQuery.trim(t[l]);if(a.substring(0,e.length+1)==e+"="){i=decodeURIComponent(a.substring(e.length+1));break}}return i}function is_set(e){return null!=e&&""!==e&&"None"!==e}$(document).ready(function(){function e(){n?($(".field-search").show(),$("#id_email").prop("readonly",!0),$("#id_first_name").prop("readonly",!0),$("#id_last_name").prop("readonly",!0)):($(".field-search").hide(),$("#id_email").prop("readonly",!1),$("#id_first_name").prop("readonly",!1),$("#id_last_name").prop("readonly",!1))}function i(){let i=getCookie("csrftoken");is_set(a)?$.ajax({beforeSend:function(e){e.setRequestHeader("X-CSRFToken",i)},url:"/api/establishment/"+a,type:"GET",success:function(i){n=null!==i.data_source_plugin,e()}}):(n=!1,e())}let t,l=0,a=$("#id_establishment").val(),n=!1,s=gettext("Results"),o=gettext("Select a user ...");e(),i(),$("#id_establishment").on("change",function(){a=this.value,i()}),$("#id_search").after("<label id='livesearch_label'>"+s+" :</label><select id='live_select' style='visibility:hidden'></select><label id='ws_message' style='display:none; width:300px;'></label>"),$("#id_search").on("input",function(){if(this.value.length>=2){var e=getCookie("csrftoken");l+=1,$.ajax({beforeSend:function(i){i.setRequestHeader("X-CSRFToken",e)},url:"/api/get_person",type:"POST",data:{username:this.value,establishment_id:a,query_order:l},success:function(e){let i=void 0!==e.msg?e.msg:"",a=void 0!==e.data?e.data[0]:"";if(""!==i?(document.getElementById("ws_message").innerHTML=i,$("#ws_message").show()):(document.getElementById("ws_message").innerHTML="",$("#ws_message").hide()),a>=l)if(t=void 0!==e.data?e.data.slice(1):null,document.getElementById("livesearch_label").style.visibility="visible",document.getElementById("live_select").style.visibility="visible",null===t)$("#id_email").val(""),$("#id_first_name").val(""),$("#id_last_name").val("");else{$("#live_select").empty().append("<option value=''>"+o+"</option>");for(var n=0;n<t.length;n++)$("#live_select").append("<option value='"+n+"'>"+t[n].display_name+"</option>")}},error:function(e){obj=JSON.stringify(e),console.log("Error : "+obj)}})}else document.getElementById("live_select").style.visibility="hidden",document.getElementById("livesearch_label").style.visibility="hidden",$("#id_email").val(""),$("#id_first_name").val(""),$("#id_last_name").val("")}),$("#live_select").on("change",function(e,i){$("option:selected",this);var l=this.value;""!==this.value?($("#id_username").val(t[l].username),$("#id_email").val(t[l].email),$("#id_first_name").val(t[l].firstname),$("#id_last_name").val(t[l].lastname)):($("#id_username").val(""),$("#id_email").val(""),$("#id_first_name").val(""),$("#id_last_name").val(""))})});